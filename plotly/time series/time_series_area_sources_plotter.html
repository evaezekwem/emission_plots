<head>
  <!-- Plotly.js -->
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>

<body>
  
    <div id="myDiv"><!-- Plotly chart will be drawn inside this DIV --></div>
    <div><input type="file" id="fileInput"></div>
  <script>
    window.onload = function() {
        var fileInput = document.getElementById('fileInput');

        fileInput.addEventListener('change', function(e) {
           var file = fileInput.files[0];
           var textType = /text.*/;
           
           if(file.type.match(textType)) {
               
               var reader = new FileReader();
               reader.onload = function(e) {
                   var contents = reader.result;
                   var species = ['CO2', 'CH4', 'BC', 'SO2', 'CO', 'OC', 'N2O', 'NOx', 'NH3'];
                   var sources = ['SAVA','BORF','TEMF','DEFO','PEAT','AGRI'];
                   var regions = ['BONA', 'TENA', 'CEAM', 'NHSA', 'SHSA', 'EURO', 'MIDE', 'NHAF', 'SHAF', 'BOAS', 'TEAS', 'SEAS', 'EQAS', 'AUST'];
                   var years = [1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014];
                   var colors = ['#ff0066', '#660066', '#0000ff', '#009900', '#ff3300', '#800026']
                   //var colors = ['#ff0066', '#660066', '#6600cc', '#0000ff', '#006666', '#00004d', '#009900', '#ffff00', '#ff3300', '#800026', "#333300", "663300", "#999966", "#000000"]
                   var traces = [];
                   var sources_data = contents.split("SOURCE");
                   
                   //source
                   for(i = 0; i < 6; i++) {
                       var this_source = sources_data[i];
                       var these_species = this_source.split("SPECIES");
                       for(j = 0; j < 9; j++) {
                           var species = JSON.parse(these_species[j]);
                           var hoverinfo = 'none';
                           var fill = 'tonexty';
                           var showlegend = false;
                           var name = sources[i] + " " + species[j];
                           if(i == 0 && j == 0) {
                               fill = 'tozeroy'
                               showlegend = true;
                               name = ""
                           }
                           if(j == 8) {
                               hoverinfo = "all"
                               showlegend = true;
                               name = sources[i];
                           }
                           traces.push({x: years, y: species, fill: fill, marker: {color: colors[i]}, hoverinfo: hoverinfo, showlegend: showlegend, name: name});

                       }
                   }
                   
                    function stackedArea(traces) {
                        for(var i=1; i<traces.length; i++) {
                            for(var j=0; j<(Math.min(traces[i]['y'].length, traces[i-1]['y'].length)); j++) {
                                traces[i]['y'][j] += traces[i-1]['y'][j];
                            }
                        }
                        return traces;
                    }
                    
                    var layout = {
                        title: 'Annual Cost by Source and Species',
                        height: 750, 
                        xaxis: {
                            title: 'Year',
                        },
                        yaxis: {
                            title: 'Billion US$'
                        }
                    }

                    Plotly.newPlot('myDiv', stackedArea(traces), layout);
               }
               reader.readAsText(file);
           } 
           else {
               alert("Not supported!")
           }
        });
    }



  </script>
</body>